<?xml version="1.0"?>
<ArcConfig
  xmlns="http://www.nordugrid.org/schemas/ArcConfig/2007"
  xmlns:tcp="http://www.nordugrid.org/schemas/ArcMCCTCP/2007"
  xmlns:arex="http://www.nordugrid.org/schemas/ArcConfig/2009/arex"
  xmlns:ip="http://www.nordugrid.org/schemas/ArcConfig/2009/arex/InfoProvider"
  xmlns:lrms="http://www.nordugrid.org/schemas/ArcConfig/2009/arex/LRMS"
>
  <!-- Common configuration of the daemon -->
  <Server>
    <PidFile>/var/run/arched.pid</PidFile>
    <Logger level="VERBOSE">/var/log/arched.log</Logger>
  </Server>
  <!-- Where to find plugins -->
  <ModuleManager>
    <Path>@prefix@/lib/arc/</Path>
  </ModuleManager>
  <!-- Simply load all needed plugins -->
  <Plugins><Name>mcctcp</Name></Plugins>
  <Plugins><Name>mcctls</Name></Plugins>
  <Plugins><Name>mcchttp</Name></Plugins>
  <Plugins><Name>mccsoap</Name></Plugins>
  <Plugins><Name>arcpdc</Name></Plugins>
  <Plugins><Name>identitymap</Name></Plugins>
  <Plugins><Name>arex</Name></Plugins>
  <!-- Create a chain -->
  <Chain>
    <!-- TCP listening socket -->
    <Component name="tcp.service" id="tcp">
      <next id="tls"/>
      <tcp:Listen><tcp:Port>60000</tcp:Port></tcp:Listen>
    </Component>
    <!-- Transport-level security -->
    <Component name="tls.service" id="tls">
      <next id="http"/>
      <!-- Location of server's security keys -->
      <KeyPath>/etc/grid-security/hostkey.pem</KeyPath>
      <CertificatePath>/etc/grid-security/hostcert.pem</CertificatePath>
      <CACertificatesDir>/etc/grid-security/certificates</CACertificatesDir>
      <!-- SecHandler below calls specified Policy Decision Point components.
           In this example only one PDP is defined - simplelist.pdp. This
	   PDP compares Distinguished Name of connecting client against
	   list of allowed DNs. DNs are stored in external file one per line.
	   They may be enclosed in '"'. -->
      <SecHandler name="arc.authz" id="pdps" event="incoming">
        <PDP name="simplelist.pdp" location="/etc/grid-security/grid-mapfile"/>
      </SecHandler>
      <!-- Evaluate requestor's identity into local identity.
           Comment it if no user mapping is needed. -->
      <SecHandler name="identity.map" id="map" event="incoming">
        <!-- Safe choice if all other rules failed -->
        <PDP name="allow.pdp"><LocalName>nobody</LocalName></PDP>
      </SecHandler>
    </Component>
    <!-- HTTP processing is done here -->
    <Component name="http.service" id="http">
      <next id="soap">POST</next>
      <next id="plexer">GET</next>
      <next id="plexer">PUT</next>
    </Component>
    <!-- This one parses content into XML tree -->
    <Component name="soap.service" id="soap">
      <next id="plexer"/>
    </Component>
    <!-- Directing messages to proper service -->
    <Plexer name="plexer.service" id="plexer">
      <next id="a-rex">^/arex</next>
    </Plexer>
    <!-- A-Rex service -->
    <Service name="a-rex" id="a-rex">
      <!-- Optional endpoint element is advised in case of multiple IP adresses -->
      <arex:endpoint>https://localhost:60000/arex</arex:endpoint>
      <!-- Use information generated by identity.map plugin or default provided below -->
      <arex:usermap><arex:defaultLocalName>nobody</arex:defaultLocalName></arex:usermap>

      <arex:gmrun>internal</arex:gmrun>
      <arex:commonName>A-REX</arex:commonName>
      <arex:longDescription>ARC execution service</arex:longDescription>
      <arex:LRMSName>fork</arex:LRMSName>
      <arex:OperatingSystem>LINUX</arex:OperatingSystem>
      <arex:debugLevel>DEBUG</arex:debugLevel>
      <arex:serviceMail>support@cluster.org</arex:serviceMail>

      <arex:loadLimits>
          <arex:maxJobsTracked>1000</arex:maxJobsTracked>
          <arex:maxJobsRun>100</arex:maxJobsRun>
          <arex:maxJobsTransfered>20</arex:maxJobsTransfered>
          <arex:maxJobsTransferedAdditional>2</arex:maxJobsTransferedAdditional>
          <arex:maxFilesTransfered>4</arex:maxFilesTransfered>
          <arex:maxJobsPerShare shareType="dn">4</arex:maxJobsPerShare>
      </arex:loadLimits>
      <arex:dataTransfer>
          <arex:Globus>
              <arex:gridmapfile>/etc/grid-security/grid-mapfile</arex:gridmapfile>
              <arex:cadir>/etc/grid-security/certificates</arex:cadir>
              <arex:certpath>/etc/grid-security/hostcert.pem</arex:certpath>
              <arex:keypath>/etc/grid-security/hostkey.pem</arex:keypath>
          </arex:Globus>
      </arex:dataTransfer>
      <arex:jobLogPath>/var/log/arex-jobs.log</arex:jobLogPath>
      <arex:control>
          <arex:username>.</arex:username>
          <arex:controlDir>/var/spool/arc/jobstatus</arex:controlDir>
          <arex:sessionRootDir>/export/sessions</arex:sessionRootDir>
          <arex:cache>
              <arex:location>
                  <arex:path>/cluster/charged/cache</arex:path>
              </arex:location>
          </arex:cache>
      </arex:control>

      <arex:LRMS>
          <arex:type>fork</arex:type>
          <arex:defaultShare>fork</arex:defaultShare>
      </arex:LRMS>

      <ip:ComputingService>
          <ip:Name>Titan</ip:Name>
          <ip:OtherInfo>This cluster is specially designed for XYZ applications: www.xyz.org</ip:OtherInfo>
          <ip:AdminDomain>HU/NIIF-TOP</ip:AdminDomain>

          <ip:Location>
              <ip:Name>Budapest, Hungary</ip:Name>
              <ip:Address>Victor Hugo 11</ip:Address>
              <ip:Place>Budapest</ip:Place>
              <ip:Country>Hungary</ip:Country>
              <ip:PostCode>HU-1200</ip:PostCode>
              <ip:Latitude>47.51</ip:Latitude>
              <ip:Longitude>19.05</ip:Longitude>
          </ip:Location>
          <ip:Contact>
              <ip:Name>NIIF User Support</ip:Name>
              <ip:Detail>support@cluster.org</ip:Detail>
              <ip:Type>usersupport</ip:Type>
          </ip:Contact>

          <ip:ExecutionEnvironment name="localhost">
              <ip:Platform>adotf</ip:Platform>
              <ip:PhysicalCPUs>adotf</ip:PhysicalCPUs>
              <ip:LogicalCPUs>adotf</ip:LogicalCPUs>
              <ip:CPUVendor>adotf</ip:CPUVendor>
              <ip:CPUModel>adotf</ip:CPUModel>
              <ip:CPUClockSpeed>adotf</ip:CPUClockSpeed>
              <ip:MainMemorySize>adotf</ip:MainMemorySize>
              <ip:OSFamily>adotf</ip:OSFamily>
              <ip:OSName>centos</ip:OSName>
              <ip:OSVersion>5.1</ip:OSVersion>
              <ip:ConnectivityIn>false</ip:ConnectivityIn>
              <ip:ConnectivityOut>true</ip:ConnectivityOut>
          </ip:ExecutionEnvironment>

          <ip:ComputingShare name="fork">
              <ip:Description>just a fork queue</ip:Description>
              <ip:MappingQueue>fork</ip:MappingQueue>
              <ip:ExecEnvName>localhost</ip:ExecEnvName>
              <ip:AuthorizedVO>nordugrid.org</ip:AuthorizedVO>
              <ip:MaxVirtualMemory>2000</ip:MaxVirtualMemory>
              <ip:SchedulingPolicy>fifo</ip:SchedulingPolicy>
              <lrms:fork_job_limit>cpunumber</lrms:fork_job_limit>
          </ip:ComputingShare>
      </ip:ComputingService>
    </Service>
  </Chain>
</ArcConfig>


<?xml version="1.0"?>
<ArcConfig
  xmlns="http://www.nordugrid.org/schemas/arcconfig/2009/08"
  xmlns:loader="http://www.nordugrid.org/schemas/loader/2009/08"
  xmlns:tcp="http://www.nordugrid.org/schemas/tcp/2009/08"
  xmlns:tls="http://www.nordugrid.org/schemas/tls/2009/08"
  xmlns:authz="http://www.nordugrid.org/schemas/arcauthz/2009/08"
  xmlns:idmap="http://www.nordugrid.org/schemas/identitymap/2009/10"
  xmlns:spdp="http://www.nordugrid.org/schemas/simplelistpdp/2009/08"
  xmlns:arex="http://www.nordugrid.org/schemas/a-rex/2009/08"
  xmlns:ip="http://www.nordugrid.org/schemas/a-rex/InfoProvider/2009/08"
  xmlns:lrms="http://www.nordugrid.org/schemas/a-rex/LRMS/2009/08"
>
  <!-- Common configuration of the daemon -->
  <Server>
    <PidFile>/var/run/arched.pid</PidFile>
    <Logger>
      <File>/var/log/arc/arched.log</File>
      <Level>DEBUG</Level>
    </Logger>
  </Server>
  <!-- Where to find plugins -->
  <loader:ModuleManager>
    <loader:Path>@prefix@/lib/arc/</loader:Path>
  </loader:ModuleManager>
  <!-- Simply load all needed plugins -->
  <loader:Plugins>
    <loader:Name>mcctcp</loader:Name>
    <loader:Name>mcctls</loader:Name>
    <loader:Name>mcchttp</loader:Name>
    <loader:Name>mccsoap</loader:Name>
    <loader:Name>arcshc</loader:Name>
    <loader:Name>identitymap</loader:Name>
    <loader:Name>arex</loader:Name>
  </loader:Plugins>
  <!-- Create a chain -->
  <loader:Chain>
    <!-- TCP listening socket -->
    <loader:Component name="tcp.service" id="tcp">
      <loader:next id="tls"/>
      <tcp:Listen><tcp:Port>60000</tcp:Port></tcp:Listen>
    </loader:Component>
    <!-- Transport-level security -->
    <loader:Component name="tls.service" id="tls">
      <loader:next id="http"/>
      <!-- Location of server's security keys -->
      <tls:KeyPath>/etc/grid-security/hostkey.pem</tls:KeyPath>
      <tls:CertificatePath>/etc/grid-security/hostcert.pem</tls:CertificatePath>
      <tls:CACertificatesDir>/etc/grid-security/certificates</tls:CACertificatesDir>
      <!-- SecHandler below calls specified Policy Decision Point components.
           In this example only one PDP is defined - simplelist.pdp. This
	   PDP compares Distinguished Name of connecting client against
	   list of allowed DNs. DNs are stored in external file one per line.
	   They may be enclosed in '"'. -->
      <loader:SecHandler name="arc.authz" id="pdps" event="incoming">
        <authz:PDP name="simplelist.pdp" spdp:location="/etc/grid-security/grid-mapfile"/>
      </loader:SecHandler>
      <!-- Evaluate requestor's identity into local identity.
           Comment it if no user mapping is needed. -->
      <loader:SecHandler name="identity.map" id="map" event="incoming">
        <!-- Safe choice if all other rules failed -->
        <idmap:PDP name="allow.pdp"><idmap:LocalName>nobody</idmap:LocalName></idmap:PDP>
      </loader:SecHandler>
    </loader:Component>
    <!-- HTTP processing is done here -->
    <loader:Component name="http.service" id="http">
      <loader:next id="soap">POST</loader:next>
      <loader:next id="plexer">GET</loader:next>
      <loader:next id="plexer">PUT</loader:next>
      <loader:next id="plexer">HEAD</loader:next>
    </loader:Component>
    <!-- This one parses content into XML tree -->
    <loader:Component name="soap.service" id="soap">
      <loader:next id="plexer"/>
    </loader:Component>
    <!-- Directing messages to proper service -->
    <loader:Plexer name="plexer.service" id="plexer">
      <loader:next id="a-rex">^/arex</loader:next>
    </loader:Plexer>
    <!-- A-Rex service -->
    <loader:Service name="a-rex" id="a-rex">
      <!-- Optional endpoint element is advised in case of multiple IP adresses -->
      <arex:endpoint>https://localhost:60000/arex</arex:endpoint>
      <!-- Use information generated by identity.map plugin or default provided below -->
      <arex:usermap><arex:defaultLocalName>nobody</arex:defaultLocalName></arex:usermap>

      <arex:gmrun>internal</arex:gmrun>
      <arex:commonName>A-REX</arex:commonName>
      <arex:longDescription>ARC execution service</arex:longDescription>
      <arex:LRMSName>fork</arex:LRMSName>
      <arex:OperatingSystem>LINUX</arex:OperatingSystem>
      <arex:debugLevel>VERBOSE</arex:debugLevel>
      <arex:serviceMail>support@cluster.org</arex:serviceMail>

      <arex:loadLimits>
          <arex:maxJobsTracked>1000</arex:maxJobsTracked>
          <arex:maxJobsRun>100</arex:maxJobsRun>
          <arex:maxJobsTransferred>20</arex:maxJobsTransferred>
          <arex:maxJobsTransferredAdditional>2</arex:maxJobsTransferredAdditional>
	  <arex:maxLoadShare>5</arex:maxLoadShare>
	  <arex:loadShareType>dn</arex:loadShareType>
          <arex:maxFilesTransferred>4</arex:maxFilesTransferred>
      </arex:loadLimits>
      <arex:dataTransfer>
          <arex:Globus>
              <arex:gridmapfile>/etc/grid-security/grid-mapfile</arex:gridmapfile>
              <arex:CACertificatesDir>/etc/grid-security/certificates</arex:CACertificatesDir>
              <arex:CertificatePath>/etc/grid-security/hostcert.pem</arex:CertificatePath>
              <arex:KeyPath>/etc/grid-security/hostkey.pem</arex:KeyPath>
          </arex:Globus>
	  <arex:maxRetries>10</arex:maxRetries>
      </arex:dataTransfer>
      <arex:jobLogPath>/var/log/arc/arex-jobs.log</arex:jobLogPath>
      <arex:control>
          <arex:username>.</arex:username>
          <arex:controlDir>/var/spool/arc/jobstatus</arex:controlDir>
          <arex:sessionRootDir>/export/sessions</arex:sessionRootDir>
          <arex:cache>
              <arex:location>
                  <arex:path>/cluster/charged/cache</arex:path>
              </arex:location>
          </arex:cache>
      </arex:control>

      <arex:LRMS>
          <arex:type>fork</arex:type>
          <arex:defaultShare>fork</arex:defaultShare>
      </arex:LRMS>

      <arex:InfoProvider>
          <arex:debugLevel>INFO</arex:debugLevel>

          <ip:ProviderLog>/var/log/arc/infoprovider.log</ip:ProviderLog>

          <ip:AdminDomain>HU/NIIF-TOP</ip:AdminDomain>
          <ip:ClusterName>Titan</ip:ClusterName>
          <ip:OtherInfo>This cluster is specially designed for XYZ applications: www.xyz.org</ip:OtherInfo>

          <ip:Location>
              <ip:Name>Budapest, Hungary</ip:Name>
              <ip:Address>Victor Hugo 11</ip:Address>
              <ip:Place>Budapest</ip:Place>
              <ip:Country>Hungary</ip:Country>
              <ip:PostCode>HU-1200</ip:PostCode>
              <ip:Latitude>47.51</ip:Latitude>
              <ip:Longitude>19.05</ip:Longitude>
          </ip:Location>
          <ip:Contact>
              <ip:Name>NIIF User Support</ip:Name>
              <ip:Detail>mailto:support@cluster.org</ip:Detail>
              <ip:Type>usersupport</ip:Type>
          </ip:Contact>

          <ip:AccessPolicy>
              <Rule>vo:atlas</Rule>
              <Rule>vo:nordugrid.org</Rule>
              <UserDomainID>voms:lcg-voms.cern.ch:15001/atlas</UserDomainID>
              <UserDomainID>voms:voms.ndgf.org:15015/nordugrid.org</UserDomainID>
          </ip:AccessPolicy>

          <ip:ExecutionEnvironment name="localhost">
              <ip:OSName>adotf</ip:OSName>
              <ip:OSVersion>adotf</ip:OSVersion>
              <ip:CPUVendor>adotf</ip:CPUVendor>
              <ip:CPUModel>adotf</ip:CPUModel>
              <ip:CPUClockSpeed>adotf</ip:CPUClockSpeed>
              <ip:ConnectivityIn>false</ip:ConnectivityIn>
              <ip:ConnectivityOut>true</ip:ConnectivityOut>
          </ip:ExecutionEnvironment>

          <ip:ComputingShare name="fork">
              <ip:Description>just a fork queue</ip:Description>
              <ip:MappingQueue>fork</ip:MappingQueue>
              <ip:ExecutionEnvironmentName>localhost</ip:ExecutionEnvironmentName>
              <ip:OSName>centos</ip:OSName>
              <ip:OSVersion>5.1</ip:OSVersion>
              <ip:MaxVirtualMemory>2000</ip:MaxVirtualMemory>
              <ip:SchedulingPolicy>fifo</ip:SchedulingPolicy>
              <lrms:fork_job_limit>cpunumber</lrms:fork_job_limit>
          </ip:ComputingShare>
      </arex:InfoProvider>
    </loader:Service>
  </loader:Chain>
</ArcConfig>


<?xml version="1.0"?>
<cfg:ArcConfig xmlns="http://www.nordugrid.org/schemas/loader/2009/08" xmlns:cfg="http://www.nordugrid.org/schemas/arcconfig/2009/08" xmlns:tcp="http://www.nordugrid.org/schemas/tcp/2009/08" xmlns:tls="http://www.nordugrid.org/schemas/tls/2009/08" xmlns:ahash="http://www.nordugrid.org/schemas/ahash/2009/08" xmlns:lib="http://www.nordugrid.org/schemas/librarian/2009/08" xmlns:bar="http://www.nordugrid.org/schemas/bartender/2009/08" xmlns:shep="http://www.nordugrid.org/schemas/shepherd/2009/08" xmlns:infosys="http://www.nordugrid.org/schemas/infosys/2009/08">
    <cfg:Server>
        <cfg:PidFile inisections="common" initag="pidfile">/tmp/arched.pid</cfg:PidFile>
        <cfg:Logger>
            <cfg:File inisections="common" initag="logfile">/var/log/arched.log</cfg:File>
            <cfg:Level inisections="common" initag="debug">ERROR</cfg:Level>
        </cfg:Logger>
    </cfg:Server>
    <ModuleManager>
        <Path inisections="common" initag="libpath">@libdir@/@PACKAGE@</Path>
    </ModuleManager>
    <Plugins>
        <Name>mcctls</Name>
        <Name>mcchttp</Name>
        <Name>mccsoap</Name>
        <Name>arcshc</Name>
        <Name>mcctcp</Name>
    </Plugins>
    <Chain>
        <Component name="tcp.service" id="tcp">
            <next id="tls"/>
            <tcp:Listen>
                <tcp:Interface inisections="common" initag="interface">0.0.0.0</tcp:Interface>
                <tcp:Port inisections="common" initag="port"/>
                <tcp:Version inisections="common" initag="ipversion">4</tcp:Version>
            </tcp:Listen>
        </Component>
        <Component name="tls.service" id="tls">
            <next id="http"/>
            <tls:KeyPath inisections="common" initag="host_key"/>
            <tls:CertificatePath inisections="common" initag="host_cert"/>
            <tls:CACertificatesDir inisections="common" initag="cacert"/>
        </Component>
        <Component name="http.service" id="http">
            <next id="soap">POST</next>
            <next id="plexer">GET</next>
            <next id="plexer">PUT</next>
        </Component>
        <Component name="soap.service" id="soap">
            <next id="plexer"/>
        </Component>
        <Plexer name="plexer.service" id="plexer">
            <next id="ahash" inisections="ahash" initag="urlpattern">^/AHash$</next>
            <next id="librarian" inisections="librarian" initag="urlpattern">^/Librarian$</next>
            <next id="bartender" inisections="bartender" initag="urlpattern">^/Bartender$</next>
            <next id="shepherd" inisections="shepherd" initag="urlpattern">^/Shepherd$</next>
            <next id="hopi" inisections="hopi" initag="urlpattern">^/Hopi/</next>
        </Plexer>
        <Service name="pythonservice" id="ahash">
            <ahash:ClassName>storage.ahash.ahash.AHashService</ahash:ClassName>
            <ahash:AHashClass>storage.ahash.replicatedahash.ReplicatedAHash</ahash:AHashClass>
            <ahash:LocalDir inisections="ahash" initag="datadir">/var/spool/arc/ahash_data</ahash:LocalDir>
            <ahash:MyURL inisections="ahash" initag="endpoint"/>
            <ahash:OtherURL inisections="ahash" initag="peerurl1"/>
            <ahash:OtherURL inisections="ahash" initag="peerurl2"/>
            <ahash:OtherURL inisections="ahash" initag="peerurl3"/>
            <ahash:Priority inisections="ahash" initag="priority">50</ahash:Priority>
            <ahash:ClientSSLConfig>
                <ahash:KeyPath inisections="common ahash" initag="client_key"/>
                <ahash:CertificatePath inisections="common ahash" initag="client_cert"/>
                <ahash:CACertificatesDir inisections="common ahash" initag="cacert"/>
            </ahash:ClientSSLConfig>
            <infosys:InfoRegister>
                <infosys:Period inisections="register ahash" initag="period">PT20S</infosys:Period>
                <infosys:Endpoint inisections="ahash" initag="endpoint"/>
                <infosys:Expiration inisections="register ahash" initag="expiration">PT100S</infosys:Expiration>
                <infosys:Registrar>
                    <infosys:URL inisections="register ahash" initag="index_server1"/>
                    <infosys:KeyPath inisections="common ahash" initag="client_key"/>
                    <infosys:CertificatePath inisections="common ahash" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common ahash" initag="cacert"/>
                </infosys:Registrar>
                <infosys:Registrar>
                    <infosys:URL inisections="register ahash" initag="index_server2"/>
                    <infosys:KeyPath inisections="common ahash" initag="client_key"/>
                    <infosys:CertificatePath inisections="common ahash" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common ahash" initag="cacert"/>
                </infosys:Registrar>
                <infosys:Registrar>
                    <infosys:URL inisections="register ahash" initag="index_server3"/>
                    <infosys:KeyPath inisections="common ahash" initag="client_key"/>
                    <infosys:CertificatePath inisections="common ahash" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common ahash" initag="cacert"/>
                </infosys:Registrar>
            </infosys:InfoRegister>
        </Service>
        <Service name="pythonservice" id="bartender">
            <bar:ClassName>storage.bartender.bartender.BartenderService</bar:ClassName>
            <bar:ISISURL inisections="register bartender" initag="index_server1"/>
            <bar:ISISURL inisections="register bartender" initag="index_server2"/>
            <bar:ISISURL inisections="register bartender" initag="index_server3"/>
            <bar:ClientSSLConfig>
                <bar:KeyPath inisections="common bartender" initag="client_key"/>
                <bar:CertificatePath inisections="common bartender" initag="client_cert"/>
                <bar:CACertificatesDir inisections="common bartender" initag="cacert"/>
            </bar:ClientSSLConfig>
            <infosys:InfoRegister>
                <infosys:Period inisections="register bartender" initag="period">PT20S</infosys:Period>
                <infosys:Endpoint inisections="bartender" initag="endpoint"/>
                <infosys:Expiration inisections="register bartender" initag="expiration">PT100S</infosys:Expiration>
                <infosys:Registrar>
                    <infosys:URL inisections="register bartender" initag="index_server1"/>
                    <infosys:KeyPath inisections="common bartender" initag="client_key"/>
                    <infosys:CertificatePath inisections="common bartender" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common bartender" initag="cacert"/>
                </infosys:Registrar>
                <infosys:Registrar>
                    <infosys:URL inisections="register bartender" initag="index_server2"/>
                    <infosys:KeyPath inisections="common bartender" initag="client_key"/>
                    <infosys:CertificatePath inisections="common bartender" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common bartender" initag="cacert"/>
                </infosys:Registrar>
                <infosys:Registrar>
                    <infosys:URL inisections="register bartender" initag="index_server3"/>
                    <infosys:KeyPath inisections="common bartender" initag="client_key"/>
                    <infosys:CertificatePath inisections="common bartender" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common bartender" initag="cacert"/>
                </infosys:Registrar>
            </infosys:InfoRegister>
        </Service>
        <Service name="pythonservice" id="librarian">
            <lib:ClassName>storage.librarian.librarian.LibrarianService</lib:ClassName>
            <lib:ISISURL inisections="register librarian" initag="index_server1"/>
            <lib:ISISURL inisections="register librarian" initag="index_server2"/>
            <lib:ISISURL inisections="register librarian" initag="index_server3"/>
            <lib:HeartbeatTimeout inisections="librarian" initag="heartbeattimeout">60</lib:HeartbeatTimeout>
            <lib:CheckPeriod inisections="librarian" initag="checkperiod">20</lib:CheckPeriod>
            <lib:ClientSSLConfig>
                <lib:KeyPath inisections="common librarian" initag="client_key"/>
                <lib:CertificatePath inisections="common librarian" initag="client_cert"/>
                <lib:CACertificatesDir inisections="common librarian" initag="cacert"/>
            </lib:ClientSSLConfig>
            <infosys:InfoRegister>
                <infosys:Period inisections="register librarian" initag="period">PT20S</infosys:Period>
                <infosys:Endpoint inisections="librarian" initag="endpoint"/>
                <infosys:Expiration inisections="register librarian" initag="expiration">PT100S</infosys:Expiration>
                <infosys:Registrar>
                    <infosys:URL inisections="register librarian" initag="index_server1"/>
                    <infosys:KeyPath inisections="common librarian" initag="client_key"/>
                    <infosys:CertificatePath inisections="common librarian" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common librarian" initag="cacert"/>
                </infosys:Registrar>
                <infosys:Registrar>
                    <infosys:URL inisections="register librarian" initag="index_server2"/>
                    <infosys:KeyPath inisections="common librarian" initag="client_key"/>
                    <infosys:CertificatePath inisections="common librarian" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common librarian" initag="cacert"/>
                </infosys:Registrar>
                <infosys:Registrar>
                    <infosys:URL inisections="register librarian" initag="index_server3"/>
                    <infosys:KeyPath inisections="common librarian" initag="client_key"/>
                    <infosys:CertificatePath inisections="common librarian" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common librarian" initag="cacert"/>
                </infosys:Registrar>
            </infosys:InfoRegister>
        </Service>
        <Service name="pythonservice" id="shepherd">
            <shep:ClassName>storage.shepherd.shepherd.ShepherdService</shep:ClassName>
            <shep:ServiceID inisections="shepherd" initag="endpoint"/>
            <shep:CheckPeriod inisections="shepherd" initag="checkperiod">20</shep:CheckPeriod>
            <shep:MinCheckInterval inisections="shepherd" initag="mincheckinterval">0.1</shep:MinCheckInterval>
            <shep:CreatingTimeout inisections="shepherd" initag="creatingtimeout">1000</shep:CreatingTimeout>
            <shep:ChecksumLifetime inisections="shepherd" initag="checksumlifetime">3600</shep:ChecksumLifetime>
            <shep:StoreClass>arcom.store.cachedpicklestore.CachedPickleStore</shep:StoreClass>
            <shep:StoreCfg>
                <shep:DataDir inisections="shepherd" initag="datadir">/var/spool/arc/shepherd_data</shep:DataDir>
            </shep:StoreCfg>
            <shep:BackendClass>storage.shepherd.hardlinkingbackend.HopiBackend</shep:BackendClass>
            <shep:BackendCfg>
                <shep:StoreDir inisections="shepherd" initag="storedir">/var/spool/arc/shepherd_store</shep:StoreDir>
                <shep:TransferDir inisections="shepherd" initag="transferdir">/var/spool/arc/shepherd_transfer</shep:TransferDir>
                <shep:TURLPrefix inisections="shepherd" initag="turlprefix"/>
            </shep:BackendCfg>
            <shep:ISISURL inisections="register shepherd" initag="index_server1"/>
            <shep:ISISURL inisections="register shepherd" initag="index_server2"/>
            <shep:ISISURL inisections="register shepherd" initag="index_server3"/>
            <shep:ClientSSLConfig>
                <shep:KeyPath inisections="common shepherd" initag="client_key"/>
                <shep:CertificatePath inisections="common shepherd" initag="client_cert"/>
                <shep:CACertificatesDir inisections="common shepherd" initag="cacert"/>
            </shep:ClientSSLConfig>
            <infosys:InfoRegister>
                <infosys:Period inisections="register shepherd" initag="period">PT20S</infosys:Period>
                <infosys:Endpoint inisections="shepherd" initag="endpoint"/>
                <infosys:Expiration inisections="register shepherd" initag="expiration">PT100S</infosys:Expiration>
                <infosys:Registrar>
                    <infosys:URL inisections="register shepherd" initag="index_server1"/>
                    <infosys:KeyPath inisections="common shepherd" initag="client_key"/>
                    <infosys:CertificatePath inisections="common shepherd" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common shepherd" initag="cacert"/>
                </infosys:Registrar>
                <infosys:Registrar>
                    <infosys:URL inisections="register shepherd" initag="index_server2"/>
                    <infosys:KeyPath inisections="common shepherd" initag="client_key"/>
                    <infosys:CertificatePath inisections="common shepherd" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common shepherd" initag="cacert"/>
                </infosys:Registrar>
                <infosys:Registrar>
                    <infosys:URL inisections="register shepherd" initag="index_server3"/>
                    <infosys:KeyPath inisections="common shepherd" initag="client_key"/>
                    <infosys:CertificatePath inisections="common shepherd" initag="client_cert"/>
                    <infosys:CACertificatesDir inisections="common shepherd" initag="cacert"/>
                </infosys:Registrar>
            </infosys:InfoRegister>
        </Service>
        <Service name="hopi" id="hopi">
            <DocumentRoot inisections="shepherd" initag="transferdir">/var/spool/arc/shepherd_transfer</DocumentRoot>
            <SlaveMode>1</SlaveMode>
        </Service>
    </Chain>
</cfg:ArcConfig>

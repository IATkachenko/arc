<?xml version="1.0"?>
<ArcConfig
  xmlns="http://www.nordugrid.org/schemas/arcconfig/2009/08"
  xmlns:loader="http://www.nordugrid.org/schemas/loader/2009/08"
  xmlns:tcp="http://www.nordugrid.org/schemas/tcp/2009/08"
  xmlns:tls="http://www.nordugrid.org/schemas/tls/2009/08"
  xmlns:authz="http://www.nordugrid.org/schemas/arcauthz/2009/08"
  xmlns:spdp="http://www.nordugrid.org/schemas/simplelistpdp/2009/08"
  xmlns:arex="http://www.nordugrid.org/schemas/a-rex/2009/08"
  xmlns:ip="http://www.nordugrid.org/schemas/a-rex/InfoProvider/2009/08"
  xmlns:lrms="http://www.nordugrid.org/schemas/a-rex/LRMS/2009/08"
  xmlns:infosys="http://www.nordugrid.org/schemas/InfoRegisterConfig/2008"
>
  <Server>
    <PidFile inisections="common arex" initag="pidfile">/tmp/arex_arched.pid</PidFile>
    <Logger>
      <File inisections="common arex" initag="logfile">/tmp/arex_arched.log</File>
      <Level inisections="common arex" initag="loglevel">DEBUG</Level>
    </Logger>
  </Server>
  <loader:ModuleManager>
    <loader:Path>@prefix@/lib/arc/</loader:Path>
  </loader:ModuleManager>
  <loader:Plugins>
    <loader:Name>mcctcp</loader:Name>
    <loader:Name>mcctls</loader:Name>
    <loader:Name>mcchttp</loader:Name>
    <loader:Name>mccsoap</loader:Name>
    <loader:Name>arcshc</loader:Name>
    <loader:Name>identitymap</loader:Name>
    <loader:Name>arex</loader:Name>
  </loader:Plugins>
  <loader:Chain>
    <loader:Component name="tcp.service" id="tcp">
      <loader:next id="tls"/>
      <tcp:Interface inisections="common" initag="interface">0.0.0.0</tcp:Interface>
      <tcp:Listen><tcp:Port inisections="common" initag="port">60000</tcp:Port></tcp:Listen>
      <tcp:Version>4</tcp:Version>
    </loader:Component>
    <loader:Component name="tls.service" id="tls">
      <loader:next id="http"/>
      <tls:KeyPath inisections="common" initag="x509_user_key">/etc/grid-security/hostkey.pem</tls:KeyPath>
      <tls:CertificatePath inisections="common" initag="x509_user_cert">/etc/grid-security/hostcert.pem</tls:CertificatePath>
      <tls:CACertificatesDir inisections="common" initag="x509_cert_dir">/etc/grid-security/certificates</tls:CACertificatesDir>
      <loader:SecHandler name="arc.authz" id="pdps" event="incoming">
       <!-- how to set grid-mapfile in using ini config parser??? -->
        <authz:PDP name="simplelist.pdp" spdp:location="/etc/grid-security/grid-mapfile"/>
      </loader:SecHandler>
    </loader:Component>
    <loader:Component name="http.service" id="http">
      <loader:next id="soap">POST</loader:next>
      <loader:next id="plexer">GET</loader:next>
      <loader:next id="plexer">PUT</loader:next>
    </loader:Component>
    <loader:Component name="soap.service" id="soap">
      <loader:next id="plexer"/>
    </loader:Component>
    <loader:Plexer name="plexer.service" id="plexer">
      <loader:next id="a-rex">^/arex</loader:next>
    </loader:Plexer>
    <loader:Service name="a-rex" id="a-rex">
      <arex:endpoint inisections="arex" initag="endpoint">https://localhost:60000/arex</arex:endpoint>
      <arex:usermap><arex:defaultLocalName inisections="arex" initag="usermap">nobody</arex:defaultLocalName></arex:usermap>

      <arex:gmrun>internal</arex:gmrun>
      <arex:commonName inisections="arex cluster" initag="common_name">Out-of-the-box CE</arex:commonName>
      <arex:longDescription inisections="arex cluster" initag="long_description">ARC execution service</arex:longDescription>
      <arex:LRMSName inisections="common arex" initag="lrms">fork</arex:LRMSName>
      <arex:OperatingSystem inisections="arex cluster" initag="operating_system">LINUX</arex:OperatingSystem>
      <arex:serviceMail inisections="arex cluster" initag="service_mail">support@cluster.org</arex:serviceMail>
      <arex:debugLevel inisections="arex" initag="debug">VERBOSE</arex:debugLevel>
      <arex:loadLimits>
          <arex:maxJobsTracked inisections="arex" initag="jobs_tracked">1000</arex:maxJobsTracked>
          <arex:maxJobsRun inisections="arex" initag="max_jobs_run">100</arex:maxJobsRun>
          <arex:maxJobsTransfered inisections="arex" initag="max_jobs_transfered">20</arex:maxJobsTransfered>
          <arex:maxJobsTransferedAdditional inisections="arex" initag="max_jobs_transfered_additional">2</arex:maxJobsTransferedAdditional>
          <arex:maxFilesTransfered inisections="arex" initag="files_transfered">4</arex:maxFilesTransfered>
      </arex:loadLimits>
      <arex:dataTransfer>
          <arex:Globus>
              <arex:gridmapfile inisections="common" initag="gridmap">/etc/grid-security/grid-mapfile</arex:gridmapfile>
              <arex:cadir inisections="common" initag="x509_cert_dir">/etc/grid-security/certificates</arex:cadir>
              <arex:certpath inisections="common" initag="x509_user_cert">/etc/grid-security/hostcert.pem</arex:certpath>
              <arex:keypath inisections="common" initag="x509_user_key">/etc/grid-security/hostkey.pem</arex:keypath>
          </arex:Globus>
      </arex:dataTransfer>
      <arex:jobLogPath inisections="arex cluster" initag="joblog">/tmp/arex-jobs.log</arex:jobLogPath>
      <arex:control>
          <arex:username inisections="arex" initag="username">.</arex:username>
          <arex:controlDir inisections="arex" initag="controldir">/tmp/jobstatus</arex:controlDir>
          <arex:sessionRootDir inisections="arex" initag="sessiondir">/tmp/grid</arex:sessionRootDir>
          <arex:cache>
              <arex:location>
                  <arex:path inisections="arex" initag="cachedir">/tmp/cache</arex:path>
              </arex:location>
          </arex:cache>
      </arex:control>

      <arex:LRMS>
          <arex:type inisections="common arex" initag="lrms">fork</arex:type>
          <arex:defaultShare inisections="common cluster" initag="defaultshare">fork</arex:defaultShare>
      </arex:LRMS>

      <arex:InfoProvider>
          <arex:debugLevel inisections="cluster" initag="debug">INFO</arex:debugLevel>

          <ip:AdminDomain inisections="cluster" initag="admindomain">ORG/NORDUGRID</ip:AdminDomain>
          <ip:ClusterName inisections="cluster" initag="clustername">General</ip:ClusterName>
          <ip:OtherInfo inisections="cluster" initag="otherinfo">This cluster is specially designed for XYZ applications: www.xyz.org</ip:OtherInfo>

          <ip:Location>
              <ip:Name inisections="cluster" initag="location">City, World</ip:Name>
              <ip:Address inisections="cluster" initag="address">Street 1</ip:Address>
              <ip:Place inisections="cluster" initag="city">City</ip:Place>
              <ip:Country inisections="cluster" initag="country">World</ip:Country>
              <ip:PostCode inisections="cluster" initag="postcode">11111</ip:PostCode>
              <ip:Latitude inisections="cluster" initag="latitude">47.51</ip:Latitude>
              <ip:Longitude inisections="cluster" initag="longitude">19.05</ip:Longitude>
          </ip:Location>
          <ip:Contact>
              <ip:Name inisections="cluster" initag="contact_name">User Support</ip:Name>
              <ip:Detail inisections="cluster" initag="contact_detail">mailto:support@cluster.org</ip:Detail>
              <ip:Type inisections="cluster" initag="contact_type">usersupport</ip:Type>
          </ip:Contact>

          <ip:ExecutionEnvironment name="localhost">
              <ip:OSName inisections="cluster" initag="osname">adotf</ip:OSName>
              <ip:OSVersion  inisections="cluster" initag="osversion">adotf</ip:OSVersion>
              <ip:CPUVendor inisections="cluster" initag="cpuvendor">adotf</ip:CPUVendor>
              <ip:CPUModel inisections="cluster" initag="cpumodel">adotf</ip:CPUModel>
              <ip:CPUClockSpeed inisections="cluster" initag="cpuclockspeed">adotf</ip:CPUClockSpeed>
              <ip:ConnectivityIn inisections="cluster" initag="connectivityin">false</ip:ConnectivityIn>
              <ip:ConnectivityOut inisections="cluster" initag="connectivityout">true</ip:ConnectivityOut>
          </ip:ExecutionEnvironment>


<!-- how to change this ComputingShare when needed -->
          <ip:ComputingShare name="fork">
              <ip:Description inisections="queue/fork" initag="queue_description">out-of-the-box fork queue</ip:Description>
              <ip:MappingQueue inisections="queue/fork" initag="mapping_queue">fork</ip:MappingQueue>
              <ip:ExecEnvName inisections="queue/fork" initag="exec_env_name">localhost</ip:ExecEnvName>
              <ip:OSName inisections="cluster queue/fork" initag="osname">RH</ip:OSName>
              <ip:OSVersion inisections="cluster queue/fork" initag="osversion">5.1</ip:OSVersion>
              <ip:AuthorizedVO inisections="queue/fork" initag="authorized_vo">nordugrid.org</ip:AuthorizedVO>
              <ip:MaxVirtualMemory inisections="queue/fork" initag="max_virtual_memory">2000</ip:MaxVirtualMemory>
              <ip:SchedulingPolicy inisections="queue/fork" initag="scheduling_policy">fifo</ip:SchedulingPolicy>
              <lrms:fork_job_limit inisections="queue/fork" initag="fork_job_limit">cpunumber</lrms:fork_job_limit>
          </ip:ComputingShare>
      </arex:InfoProvider>
      <infosys:InfoRegister>
            <infosys:Period inisections="register" initag="period">PT75S</infosys:Period>
            <infosys:Endpoint inisections="register arex" initag="endpoint">https://localhost:60000/arex</infosys:Endpoint>
            <infosys:Expiration inisections="register" initag="expiration">PT1M</infosys:Expiration>
            <infosys:Registrar>
                        <URL inisections="register" initag="index_server">https://your.index.server.org:50000/isis</URL>
                        <Retry inisections="register" initag="retry">4</Retry>
                        <KeyPath inisections="common register" initag="x509_client_key">/etc/grid-security/hostkey.pem</KeyPath>
                        <CertificatePath inisections="common register" initag="x509_client_cert">/etc/grid-security/hostcert.pem</CertificatePath>
                        <CACertificatesDir inisections="common register" initag="X509_cert_dir">/etc/grid-security/certificates</CACertificatesDir>
            </infosys:Registrar>
      </infosys:InfoRegister>

    </loader:Service>
  </loader:Chain>
</ArcConfig>

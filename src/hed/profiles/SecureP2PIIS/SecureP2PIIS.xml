<?xml version="1.0"?>
<cfg:ArcConfig
  xmlns="http://www.nordugrid.org/schemas/loader/2009/08"
  xmlns:cfg="http://www.nordugrid.org/schemas/arcconfig/2009/08"
  xmlns:tcp="http://www.nordugrid.org/schemas/tcp/2009/08"
  xmlns:tls="http://www.nordugrid.org/schemas/tls/2009/08"
  xmlns:isis="http://www.nordugrid.org/schemas/isis/2009/08"
  xmlns:infosys="http://www.nordugrid.org/schemas/infosys/2009/08"
  xmlns:authz="http://www.nordugrid.org/schemas/arcauthz/2009/08"
  xmlns:pdp="http://www.nordugrid.org/schemas/arcpdp/2009/08"
>
    <cfg:Server>
        <cfg:PidFile inisections="common" initag="pidfile">/var/run/isis_arched.pid</cfg:PidFile>
        <cfg:Logger>
            <cfg:File inisections="common" initag="logfile">/tmp/isis.log</cfg:File>
            <cfg:Level inisections="common" initag="debug">VERBOSE</cfg:Level>
        </cfg:Logger>
    </cfg:Server>
    <ModuleManager>
        <Path>/usr/local/lib/arc/</Path>
    </ModuleManager>
    <Plugins>
        <Name>isis</Name>
        <Name>mcctls</Name>
        <Name>mcchttp</Name>
        <Name>mccsoap</Name>
        <Name>arcshc</Name>
        <Name>mcctcp</Name>
    </Plugins>
    <Chain>
        <Component name="tcp.service" id="tcp">
            <next id="tls"/>
            <tcp:Listen>
                <tcp:Interface inisections="common" initag="interface">0.0.0.0</tcp:Interface>
                <tcp:Port inisections="common" initag="port">50000</tcp:Port>
                <tcp:Version>4</tcp:Version>
            </tcp:Listen>
        </Component>
        <Component name="tls.service" id="tls">
            <next id="http"/>
            <tls:KeyPath inisections="common" initag="host_key">/etc/grid-security/hostkey.pem</tls:KeyPath>
            <tls:CertificatePath inisections="common" initag="host_cert">/etc/grid-security/hostcert.pem</tls:CertificatePath>
            <tls:CACertificatesDir inisections="common" initag="cacert">/etc/grid-security/certificates</tls:CACertificatesDir>
        </Component>
        <Component name="http.service" id="http">
            <next id="soap">POST</next>
            <next id="plexer">GET</next>
            <next id="plexer">PUT</next>
        </Component>
        <Component name="soap.service" id="soap">
            <next id="plexer"/>
        </Component>
        <Plexer name="plexer.service" id="plexer">
            <next id="isis1">^/isis1$</next>
        </Plexer>
        <Service name="isis" id="isis1">
            <isis:DBPath inisections="isis" initag="dbpath">/tmp/isis1</isis:DBPath>
	        <isis:KeyPath inisections="common isis" initag="client_key">/etc/grid-security/hostkey.pem</isis:KeyPath>
	        <isis:CertificatePath inisections="common isis" initag="client_cert">/etc/grid-security/hostcert.pem</isis:CertificatePath>
	        <isis:CACertificatesDir inisections="common isis" initag="cacert">/etc/grid-security/certificates</isis:CACertificatesDir>
            <isis:InfoProvider>
                <isis:URL inisections="isis" initag="infoprovider0">https://localhost:50000/isis1</isis:URL>
            </isis:InfoProvider>
            <isis:InfoProvider>
                <isis:URL inisections="isis" initag="infoprovider1">https://example1.isis.org:50000/isis1</isis:URL>
            </isis:InfoProvider>
            <isis:InfoProvider>
                <isis:URL inisections="isis" initag="infoprovider2">https://example1.isis.org:50000/isis1</isis:URL>
            </isis:InfoProvider>
            <SecHandler name="arc.authz" id="authz" event="incoming">
                <authz:PDP name="arc.pdp">
                    <pdp:PolicyStore>
                        <pdp:Type>file</pdp:Type>
                        <pdp:Location inisections="isis" initag="policyfile">p2p_isis_policy.xml</pdp:Location>
                    </pdp:PolicyStore>
                </authz:PDP>
            </SecHandler>
	        <infosys:InfoRegister>
                <infosys:Period inisections="register isis" initag="period">PT75S</infosys:Period>
                <infosys:Endpoint inisections="isis" initag="endpoint">https://localhost:50000/isis1</infosys:Endpoint>
                <infosys:Expiration inisections="register isis" initag="expiration">PT1M</infosys:Expiration>
                <infosys:Registrar>
                    <infosys:URL inisections="register isis" initag="index_server">https://localhost:50000/isis1</infosys:URL>
                    <infosys:ServiceID inisections="isis" initag="serviceid">https://localhost:50000/isis1</infosys:ServiceID>
	                <infosys:KeyPath inisections="common isis" initag="client_key">>/etc/grid-security/hostkey.pem</infosys:KeyPath>
	                <infosys:CertificatePath inisections="common isis" initag="client_cert">>/etc/grid-security/hostcert.pem</infosys:CertificatePath>
	                <infosys:CACertificatesDir inisections="common isis" initag="cacert">>/etc/grid-security/certificates</infosys:CACertificatesDir>
                    <infosys:Retry inisections="register isis" initag="retry">4</infosys:Retry>
                </infosys:Registrar> 
            </infosys:InfoRegister>
        </Service>
    </Chain>
</cfg:ArcConfig>

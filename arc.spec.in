%define pkgdir arc
Name: nordugrid-arc1
Version: @VERSION@
Release: 1%{?dist}
Summary: ARC
Group: System Environment/Daemons 
License: GPLv2
URL: http://www.nordugrid.org/
Source:	%{name}-%{version}.tar.gz
BuildRoot:%{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
#
BuildRequires: pkgconfig
BuildRequires: e2fsprogs-devel
BuildRequires: gcc-java
BuildRequires: gettext
BuildRequires: python-devel
BuildRequires: glibmm24-devel
BuildRequires: glib2-devel
BuildRequires: libxml2-devel
BuildRequires: openssl-devel
#
BuildRequires: globus_common-devel
BuildRequires: globus_ftp_client-devel
BuildRequires: globus_ftp_control-devel
BuildRequires: globus_rls_client-devel
BuildRequires: globus_rsl-devel
#
# A-REX needs gSoap
BuildRequires: gsoap-devel

%description
ARC

%package client
Summary: ARC prototype clients
Group: Applications/Internet
Requires: %{name}

%description client
ARC prototype clients.

%package server
Summary: ARC Hosting Environment Daemon
Group: System Environment/Libraries
Requires: %{name}

%description server
ARC Hosting Environment Daemon (HED).

%package plugins
Summary: ARC plugins
Group: System Environment/Libraries
Requires: %{name}
# A-REX needs gSoap
Requires: gsoap

%description plugins
ARC plugins. This includes the Message Chain Components (MCCs) and
Data Manager Components (DMCs).

%package devel
Summary: ARC development files
Group: Development/Libraries
Requires: %{name}
Requires: glibmm24-devel
Requires: glib2-devel
Requires: libxml2-devel
Requires: openssl-devel

%description devel
Development files for ARC

%package python
Summary: ARC Python wrapper
Group: Development/Libraries
Requires: %{name}
Requires: python

%description python
Python wrapper for ARC

%if "%{!?disable_java:java}"
%package java
Summary: ARC Java wrapper
Group: Development/Libraries
Requires: %{name}

%description java
Java wrapper for ARC
%endif

%package doc
Summary: ARC API documentation
Group: Documentation

%description doc
ARC API docmentation

%prep
%setup -q

%build
%configure --disable-static %{?disable_java:--disable-java}
make %{?_smp_mflags}


%install
rm -rf $RPM_BUILD_ROOT
make install DESTDIR=$RPM_BUILD_ROOT
find $RPM_BUILD_ROOT -type f -name \*.la -exec rm -fv '{}' ';'

# RPM does it's own doc handling
rm -f $RPM_BUILD_ROOT%{_datadir}/doc/%{name}/KnowARC-API.pdf

%clean
rm -rf $RPM_BUILD_ROOT


%files
%defattr(-,root,root,-)
%doc ChangeLog NEWS README INSTALL AUTHORS
%{_libdir}/lib*.so.*
%{_datadir}/locale/*/LC_MESSAGES/Arc.mo

%files client
%defattr(-,root,root,-)
%{_bindir}/apsub
%{_bindir}/apstat
%{_bindir}/apkill
%{_bindir}/apecho
%{_bindir}/perftest

%files server
%defattr(-,root,root,-)
%{_sbindir}/arcserver
%{_sbindir}/grid-manager
%{_prefix}/libexec/smtp-send
%doc %{_mandir}/man8/arcserver.8*

%files devel
%defattr(-,root,root,-)
%{_includedir}/%{pkgdir}
#%{_libdir}/lib*.a
#%{_libdir}/lib*.la
%{_libdir}/lib*.so

%files plugins
%defattr(-,root,root,-)
%{_libdir}/%{pkgdir}/libmcc*.so
%{_libdir}/%{pkgdir}/libdmc*.so
%{_libdir}/%{pkgdir}/libsecurity.so
%{_libdir}/%{pkgdir}/libarcservice_pythonwrapper.so
%if "%{!?disable_java:java}"
%{_libdir}/%{pkgdir}/libarcservice_javawrapper.so
%endif
%{_libdir}/%{pkgdir}/libarex.so
%{_libdir}/%{pkgdir}/libecho.so

%files python
%defattr(-,root,root,-)
%{_libdir}/python?.?/site-packages/

%if "%{!?disable_java:java}"
%files java
%defattr(-,root,root,-)
%{_libdir}/java/libjarc.so
%{_datadir}/java/arc.jar
%endif

%files doc
%defattr(-,root,root,-)
%doc doc/KnowARC-API.pdf

%changelog

* Fri Jul 27 2007 Anders Waananen <waananen@nbi.dk> - 1.0-1
- Initial release

